# 见证Android消息推送时刻 #

# Day01 #

## 1、长连接和短连接 ##

* 长连接是指客户端和服务器之间始终建立着一个通信连接，在连接没有中断之前，客户端和服务器端之间可以随时进行通信。
   * 长连接实例Socket，互相发送消息可以实时收到。
   * 即时通讯Socket——推送，真正的即时通讯。
   
   
* 短连接是值通讯双方有数据交互时，就建立一个连接，数据发送完成后，则断开连接。
   * 短连接实例Http，比如浏览器。 客户端与服务器是没有连接的，当连接时，服务器返回数据到客户端，传输完毕，断开连接。
   * 即时通讯使用短连接来做——伪即使通讯。因为需要客户端每隔一定的时间向服务器请求数据，连接服务器，返回数据，断开连接——轮询。

   
## 2、Socket的使用和Mina框架讲解 ##

1. Android消息推动依靠——服务器与客户端建立长连接（服务器向客户端发送消息）
2. 不会使用原生的Socket，而是使用封装好的Mina
3. Nio（New IO）用法非常复杂，因此NIO再次封装Mina

***
# Day02 #

### 1、Apache Mina ###

* 需要两个包：log4j-1.2.17.jar（日志作用） + mina-core-2.0.7.jar

* 网络管理的代码与消息管理的代码分开处理，处理消息使用专门的Handler。

* public void messageReceived(IoSession session, Object message)。 Mina接受的数据是可以是任意对象，但是数据最终会是以字节的形式在网络上传输。

* Mina服务器的简单应用需要4个步骤：
  1. 新建NioSocketAcceptor
  2. acceptor.setHandler(new MyServerHandler());//消息收发
  3. 拦截器 acceptor.getFilterChain()，所有Mina接受的数据，要经过拦截器的过滤之后，才会接收或者发送。拦截器负责把字节流转化为Object
  4. acceptor.bind(new InetSocketAddress(9898));

* acceptor.getSessionConfig().setIdleTime(IdleStatus.BOTH_IDLE,5)//检测服务器是否空闲，这个功能常见于服务器检测客户端是否断线。心跳机制，客户端每隔多少时间向服务器发送消息，服务器多久时间没有收到消息就做相应的处理（例如：把客户端踢下线）。
 
***
### 2、Mina的基本特点 ###

* Mina同时提供了网络通讯的Server端、Client端的封装，Mina API将真正的网络通信与我们的应用程序隔离开来，你只要关心你要发送、接受的数据以及你的业务逻辑即可。
>  数据缓冲区：  一个人要把水龙头流出来的水弄到水缸里面去，要是没有缓冲池，每流出一滴水，你都要跑两趟水龙头与缸之间的距离（这个在传文件的时候就是磁盘读写的      时间），而当你有一个缓冲池（比如盆），你可以等盆满了再把水弄过去（这之间你可以做其他的事，在JAVA中，你就是CPU）……
  所以有缓冲区的话，你可以节省CPU的大量时间，而且可以对缓冲区中的数据进行集中读写，这样不必每来一个数据你去到磁道上搜索地址，然后再回来接受数据，再去搜索地址存取数据，再回来接受数据。
  缓冲区的大小根据你的用户的上传文件的大小设置，一般取平均值，这个要经验的。注意：缓冲区大小不是上传文件的平均值大小

